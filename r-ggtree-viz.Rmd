---
title: 'Phylogenetic Tree Visualization'
---

```{r, echo=FALSE, message=FALSE, eval=TRUE}
library(knitr)
opts_chunk$set(message=FALSE, warning=FALSE, eval=TRUE, echo=TRUE, cache=TRUE)
options(digits=3)
options(max.print=200)
library(ggtree)

```


This lesson demonstrates how to use **ggtree**, an extension of the ggplot2 package to visualize phylogenetic trees. 


## The `ggtree` package

+ **ggtree Bioconductor page**: [bioconductor.org/packages/ggtree](http://bioconductor.org/packages/release/bioc/html/ggtree.html).
+ **ggtree homepage**: [guangchuangyu.github.io/ggtree](https://guangchuangyu.github.io/ggtree/) (contains more information about the package, more documentation, a gallery of beautiful images, and links to related resources).
+ **ggtree publication**: 
  1.  **G Yu**, DK Smith, H Zhu, Y Guan, TTY Lam<sup>\*</sup>. ggtree: an
    R package for visualization and annotation of phylogenetic trees
    with their covariates and other associated data. ***Methods in
    Ecology and Evolution***. 2017, 8(1):28-36. doi:
    [10.1111/2041-210X.12628](https://doi.org/10.1111/2041-210X.12628).
  2.  **G Yu**<sup>\*</sup>, TTY Lam, H Zhu, Y Guan<sup>\*</sup>. Two
    methods for mapping and visualizing associated data on phylogeny
    using ggtree. ***Molecular Biology and Evolution***, 2018,
    35(2):3041-3043. doi:
    [10.1093/molbev/msy194](https://doi.org/10.1093/molbev/msy194).

## Basic tree visualization

After the tree was loaded into R, we can use **ggtree** to visualize the tree. **ggtree** supports tree imported by generated by most of the other R packages, including `phylo` and `multiPhylo` objects defined in [ape](https://cran.r-project.org/web/packages/ape/index.html), `phylo4` and `phylo4d` objects defined in [phylobase](https://cran.r-project.org/web/packages/phylobase/index.html), `phyloseq` object defined in [phyloseq](https://www.bioconductor.org/packages/phyloseq), `obkdata` object defined in [OutbreakTools](https://cran.r-project.org/web/packages/OutbreakTools/index.html) and `treedata` object defined in [treeio](r-treeio.html).

Let's load the library and then import the tree using `read.tree`. 

```{r}
library(ggtree)
tree <- read.tree("data/tree.nwk")
tree
```


Displaying the tree structure is easy, just use `ggtree` function. The `ggtree()` function is essentially a shortcut for `ggplot() + geom_tree() + theme_tree()`.

```{r}
# ggplot(tree) + geom_tree() + theme_tree()

ggtree(tree)
```



There's also the treescale geom, which adds a scale bar, or alternatively, you can change the default `ggtree()` theme to `theme_tree2()`, which adds a scale on the x-axis. The horizontal dimension in this plot shows the amount of genetic change, and the branches and represent evolutionary lineages changing over time. The longer the branch in the horizonal dimension, the larger the amount of change, and the scale tells you this. The units of branch length are usually nucleotide substitutions per site -- that is, the number of changes or substitutions divided by the length of the sequence (alternatively, it could represent the percent change, i.e., the number of changes per 100 bases). 

```{r scales, fig.keep="last"}
# add a scale
ggtree(tree) + geom_treescale()

# or add the entire scale to the x axis with theme_tree2()
ggtree(tree) + theme_tree2()
```

The default is to plot a phylogram, where the x-axis shows the genetic change / evolutionary distance. If you want to disable scaling and produce a cladogram instead, set the `branch.length="none"` option inside the `ggtree()` call. See `?ggtree` for more.

```{r cladogram}
ggtree(tree, branch.length="none")
```

We can change the line type, size, and color or mapping numerical/categorical variables to scale these visual characteristics (we'll get to that later).

```{r}
ggtree(tree, linetype='dashed', color='purple', size=2) + theme_tree('black')
```


To display taxa label, we can add a layer using `+ geom_tiplab()` (`xlim()` here is to allocate more space, otherwise the labels may be truncated).

```{r}
ggtree(tree) + geom_tiplab() + xlim(0, 5) 
```

### Exercise 1

1. visualize the `tree` by coloring branches using branch lengthes. 
2. displayed node label using `+geom_nodelab()`

```{r eval=F, echo=F}
ggtree(tree, aes(color = branch.length))
ggtree(tree) + geom_nodelab(hjust=-.1)
```

## Tree layouts

**ggtree** supports several layouts, including:

+ rectangular (by default)
+ slanted
+ circular
+ fan

for phylogram (by default) and cladogram if user explicitly setting `branch.length='none'` or missing branch length in the tree, time-scaled, two-dimensional and unrooted tree layouts are also supported.


```{r}
## circular layout
ggtree(tree, layout = 'circular')
```

```{r}
## unrooted layout using 'daylight' algorithm
ggtree(tree, layout='daylight')
```

### Exercise 2

1. Create a slanted phylogram
2. create a circular cladogram with thick red lines


```{r echo=F, eval=F}
ggtree(tree, layout='slanted')
ggtree(tree, layout="circular", branch.length="none", color="red", size=3)
```




